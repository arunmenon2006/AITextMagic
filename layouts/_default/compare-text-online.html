{{ define "main" }}
<div class="container">
  <h1>Online Text Compare Tool</h1>
  <p>Paste two texts below and find the differences easily.</p>

  <div class="input-section">
    <textarea id="text1" placeholder="Enter first text here..."></textarea>
    <textarea id="text2" placeholder="Enter second text here..."></textarea>
  </div>

  <div class="controls">
    <button onclick="compareTexts()">Compare</button>
    <select id="viewMode" onchange="compareTexts()">
      <option value="side">Side by Side</option>
      <option value="inline">Inline</option>
    </select>
  </div>

  <div id="results"></div>
</div>

<style>
/* your CSS here (same as before) */
</style>

<script>
  function compareTexts() {
    const text1 = document.getElementById("text1").value.split(/\s+/);
    const text2 = document.getElementById("text2").value.split(/\s+/);
    const viewMode = document.getElementById("viewMode").value;
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    const diff = diffTexts(text1, text2);

    if (viewMode === "side") resultsDiv.appendChild(renderSideBySide(diff));
    else resultsDiv.appendChild(renderInline(diff));
  }

  function diffTexts(a, b) {
    const m = a.length, n = b.length;
    const dp = Array(m+1).fill(null).map(() => Array(n+1).fill(0));

    for (let i=m-1;i>=0;i--){
      for (let j=n-1;j>=0;j--){
        if(a[i]===b[j]) dp[i][j]=dp[i+1][j+1]+1;
        else dp[i][j]=Math.max(dp[i+1][j],dp[i][j+1]);
      }
    }

    let i=0,j=0;
    const diff=[];
    while(i<m && j<n){
      if(a[i]===b[j]) { diff.push({type:"unchanged",word:a[i]}); i++; j++; }
      else if(dp[i+1][j]>=dp[i][j+1]) { diff.push({type:"removed",word:a[i++]}); }
      else { diff.push({type:"added",word:b[j++]}); }
    }
    while(i<m) diff.push({type:"removed",word:a[i++]});
    while(j<n) diff.push({type:"added",word:b[j++]});
    return diff;
  }

  function renderSideBySide(diff) {
    const container=document.createElement("div"); container.className="results-grid";
    const leftResult=document.createElement("div"); leftResult.className="result-box";
    const rightResult=document.createElement("div"); rightResult.className="result-box";

    diff.forEach(part=>{
      const spanLeft=document.createElement("span");
      const spanRight=document.createElement("span");

      if(part.type==="unchanged"){spanLeft.textContent=part.word+" "; spanRight.textContent=part.word+" ";}
      else if(part.type==="removed"){spanLeft.textContent=part.word+" "; spanLeft.className="diff-removed";}
      else if(part.type==="added"){spanRight.textContent=part.word+" "; spanRight.className="diff-added";}

      leftResult.appendChild(spanLeft); rightResult.appendChild(spanRight);
    });

    container.appendChild(leftResult); container.appendChild(rightResult);
    return container;
  }

  function renderInline(diff){
    const box=document.createElement("div"); box.className="results-inline";
    diff.forEach(part=>{
      const span=document.createElement("span"); span.textContent=part.word+" ";
      if(part.type==="unchanged") span.className="diff-unchanged";
      else if(part.type==="removed") span.className="diff-removed";
      else if(part.type==="added") span.className="diff-added";
      box.appendChild(span);
    });
    return box;
  }
</script>

{{ end }}
